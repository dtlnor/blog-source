---
title: 使用油猴脚本重定向解决使用百度时遇到的百度 APP 广告页面
date: 2019-04-26 13:52:08
updated: 2019-04-26 13:52:08
thumbnail: https://ae01.alicdn.com/kf/HTB1PqXUSW6qK1RjSZFm7600PFXaT.png
thumbnail_webp: https://ae01.alicdn.com/kf/H6e849a055aa24a6794a5963a0af8a6c3v.jpg
thumbnail_avif: https://vfile.meituan.net/mmdb/6659dc1ee0f8eaa966db28d85de66e3628507.jpg
thumbnail_color: data:image/jpeg;base64,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
---

虽然百度搜索的声望近年来一落千丈，但是不可否认的是，在搜索某些方面的东西时它相对于 Google 还是有很大优势的。

比如……小透明作为学生党，经常有搜索习题解析~~抄答案~~的需求。在这件事上百度就可以吊打 Google：使用题目原文进行搜索，Google 不一定能搜索到有价值的东西，但是使用百度的话——百度文库有相关习题集的参考答案、百度知道或者作业帮上早就有热心网友写好了题目解析，借鉴~~照抄~~起来非常方便(´ﾟωﾟ｀)

当然，百度的搜索结果中，位于最前面的除了广告就是百度自家的东西，实在是有失公允……百度作过的恶不少，不过这个并不是小透明今天写这篇废文的重点(='_'=)

今天小透明在搜索某个数学名词的时候，再次被百度恶心了一把，一图流：

<img data-src-webp="https://ae01.alicdn.com/kf/Ua0ef88ed588b478e8b785866b85c7dddY.jpg" data-src="https://ae01.alicdn.com/kf/HTB1wZR9S4jaK1RjSZFA762dLFXa7.png">

暂且不论为什么搜索数学名词也会出现一个 C$DN，只是当小透明点进去的时候，屏幕上并没有出现想要看到的页面，而是弹出了……(°ー°〃)？

完全不能进入想要查看的网页，只有一个以“更佳阅读体验”的名义强行插入的“下载百度 APP”的广告，就和春节期间进行过的推广活动一样( •̥́ ˍ •̀ )

<img data-src-webp="https://ae01.alicdn.com/kf/U1e563ecd2c3d40e993bd4b986a9480882.jpg" data-src="https://ae01.alicdn.com/kf/HTB1hJFTS3DqK1RjSZSyq6yxEVXaZ.jpg">

>“我从未见过有如此厚颜无耻之人！”

更有趣的是，这个广告在小透明日常使用的猴机版 Firefox 之外都是无法复现的。使用 PC 版 Firefox 打开“响应式设计模式”（相当于使用手机的屏幕尺寸和 User-Agent）和 MIUI 自带的浏览器进行测试，搜索相同的关键词“旋转曲面面积 圆柱”，点开这个 C$DN 的搜索结果，都没有出现广告∑(ﾟдﾟ*)

嗯……不知道是不是被针对了？‪( ⸝⸝⸝•_•⸝⸝⸝ )‬

---

碰到了这种事情，真的去下载 APP 当然是不可能的，应该想个办法绕过去才对(´っω･｡｀)先看一下这个网页的 URL：

```plaintext
https://mbd.baidu.com/ma/tips?
t=wise_smartpage&
swanUrl=%2Fpages%2Fblog%2Farticle-detail%3FarticleId%3D85639823%26callback%3D_bdbox_js_582%26oauthType%3Dsearch%26upgrade%3D0%26userName%3Dweixin_33874713&
appKey=obyjgY148KrH0rrRwn9OgySgEhwHgBzK&
webUrl=https%3A%2F%2Fblog.csdn.net%2Fweixin_33874713%2Farticle%2Fdetails%2F85639823&
word=%E6%97%8B%E8%BD%AC%E6%9B%B2%E9%9D%A2%E9%9D%A2%E7%A7%AF%2B%E5%9C%86%E6%9F%B1&
swan_from=1270000000000000&
from=1000969a&
title=%E6%97%8B%E8%BD%AC%E6%9B%B2%E9%9D%A2%E9%9D%A2%E7%A7%AF%2B%E5%9C%86%E6%9F%B1&
gpc=&
m=&
nojc=&
pn=&
sa=oxi_tieba_2&
si=&
srlang=&
usm=&
keysearch=manuldq
```

URL 实在是太太太长了～所以小透明按照参数把它拆成了若干行。另外点击旁边的“复制代码”按钮（原版 Material Theme 是没有的，是小透明**自己加上的功能**～）然后粘贴到地址栏，就可以看到百度的 APP 广告了……(⋟﹏⋞)

如果仔细看的话，这里面有个叫 `webUrl` 的参数，内容就是编码后的要访问的网页 URL。JS 中有个函数 `decodeURIComponent()` 可以对编码后的 URL 进行解码：

```js
//输出：https://www.google.com/
decodeURIComponent('https%3A%2F%2Fwww.google.com%2F');
```

另外，要从当前访问的 URL 中提取参数，也有已经造好的轮子(っ╹◡╹)ﾉ比如下面这个使用正则表达式的实现：

```js
function getQueryString(name) {
    var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
    var r = window.location.search.substr(1).match(reg);
    if (r != null) {
        return unescape(r[2]);
    }
    return null;
}

//假设当前访问的URL是：https://www.google.com/search?client=firefox-b-d&q=TransparentLC

//输出：firefox-b-d
getQueryString('client');

//输出：TransparentLC
getQueryString('q');
```

要在访问网站时自动执行一段 JS，可以使用油猴脚本。各位 Firefox 或者 Chrome 的用户应该都听说过名字叫“Greasemonkey”或者"Tampermonkey"的扩展（国产套壳浏览器不配被称为浏览器(っ'-')╮），装上之后就可以写一段油猴脚本（或者叫“用户脚本”，实际上是 JS）然后指定在这个广告页面的域名 `https://mbd.baidu.com/` 上应用～

```js
// ==UserScript==
// @name         New Userscript
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  try to take over the world!
// @author       You
// @match        *://mbd.baidu.com/*
// @grant        none
// ==/UserScript==
​
(function () {
    'use strict';
    function getQueryString (name) {
        var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
        var r = window.location.search.substr(1).match(reg);
        if (r != null) {
            return unescape(r[2]);
        }
        return null;
    }
    location.href = decodeURIComponent(getQueryString('webUrl'));
})();
```

这个脚本的功能就是在打开广告页面的时候，从 `webUrl` 参数中提取真实地址，然后自动跳转。

直接把脚本写进 Tampermonkey 的模板里面了，标题说明作者版本号都没改（逃

新建脚本的时候把这一堆粘贴进去然后保存就可以了ε-(•́ω•̀๑)

（不过手机上编辑油猴脚本很麻烦的说……）